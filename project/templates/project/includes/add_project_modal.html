<!-- project/includes/add_project_modal.html -->
<div class="modal fade" id="addProjectModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <form method="post" enctype="multipart/form-data">
      {% csrf_token %}
      <input type="hidden" name="add_project" value="1">
      <div class="modal-content">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title">Add New Project</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="project-form-fields">
          {% for field in project_form %}
            <div class="mb-3" id="div_{{ field.name }}">
              <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
              {{ field }}
            </div>
          {% endfor %}
        </div>
		
				<!-- Required Skills Selection -->
		<div class="row mb-3">
		  <div class="col-md-6">
			<label for="main_skill" class="form-label">Main Skill</label>
			<select id="main_skill" class="form-select">
			  <option value="">-- Select Main Skill --</option>
			  {% for skill in main_skills %}
				<option value="{{ skill.id }}">{{ skill.name }}</option>
			  {% endfor %}
			</select>
		  </div>

		  <div class="col-md-6">
			<label for="subskill" class="form-label">Subskill</label>
			<select id="subskill" class="form-select" disabled>
			  <option value="">-- Select Subskill --</option>
			</select>
		  </div>
		</div>

		<div class="mb-3">
		  <button type="button" class="btn btn-primary" id="add-skill-btn">Add Skill</button>
		</div>

		<!-- Display added skill pairs -->
		<ul id="added-skills-list" class="list-group mb-3"></ul>

		<!-- Hidden input to store selected skills for POST -->
		<input type="hidden" name="selected_skills" id="selected_skills">

		
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Add Project</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
  const mainSkillDropdown = document.getElementById('main_skill');
  const subskillDropdown = document.getElementById('subskill');
  const addSkillBtn = document.getElementById('add-skill-btn');
  const addedSkillsList = document.getElementById('added-skills-list');
  const selectedSkillsInput = document.getElementById('selected_skills');

  let selectedSkills = [];

  mainSkillDropdown.addEventListener('change', function () {
    const mainSkillId = this.value;
    if (!mainSkillId) {
      subskillDropdown.innerHTML = '<option value="">-- Select Subskill --</option>';
      subskillDropdown.disabled = true;
      return;
    }

    fetch(`/manager/load-subskills/?main_skill=${mainSkillId}`)
      .then(response => response.json())
      .then(data => {
        subskillDropdown.disabled = false;
        subskillDropdown.innerHTML = '<option value="">-- Select Subskill --</option>';
        data.forEach(sub => {
          subskillDropdown.innerHTML += `<option value="${sub.id}">${sub.name}</option>`;
        });
      });
  });

  addSkillBtn.addEventListener('click', function () {
    const mainSkillText = mainSkillDropdown.options[mainSkillDropdown.selectedIndex]?.text;
    const mainSkillId = mainSkillDropdown.value;
    const subskillText = subskillDropdown.options[subskillDropdown.selectedIndex]?.text;
    const subskillId = subskillDropdown.value;

    if (!mainSkillId || !subskillId) {
      alert("Please select both main skill and subskill");
      return;
    }

    const skillObj = { main_skill_id: mainSkillId, main_skill_name: mainSkillText, subskill_id: subskillId, subskill_name: subskillText };
    selectedSkills.push(skillObj);

    const li = document.createElement('li');
    li.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
    li.innerHTML = `${mainSkillText} â†’ ${subskillText} <button type="button" class="btn btn-sm btn-danger remove-skill">Remove</button>`;

    // Add remove button functionality
    li.querySelector('.remove-skill').addEventListener('click', function () {
      const index = Array.from(addedSkillsList.children).indexOf(li);
      selectedSkills.splice(index, 1);
      li.remove();
      selectedSkillsInput.value = JSON.stringify(selectedSkills);
    });

    addedSkillsList.appendChild(li);
    selectedSkillsInput.value = JSON.stringify(selectedSkills);

    // Reset dropdowns
    mainSkillDropdown.value = "";
    subskillDropdown.innerHTML = '<option value="">-- Select Subskill --</option>';
    subskillDropdown.disabled = true;
  });
});
</script>

