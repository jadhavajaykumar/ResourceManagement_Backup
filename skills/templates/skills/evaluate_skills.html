{% extends "base.html" %}
{% load static %}
{% block content %}
{% load skill_extras %}
<div class="container mt-3">
  <h4>Evaluate {{ main_skill.name }} â€” {{ employee.user.get_full_name }}</h4>
  {% if aggregated is not None %}
    <p>Aggregated rating: <strong>{{ aggregated }}</strong> (average of manager ratings)</p>
  {% else %}
    <p class="text-muted">No ratings yet.</p>
  {% endif %}

  <form method="post">
    {% csrf_token %}
    <table class="table table-sm">
      <thead>
        <tr>
          <th>#</th>
          <th>Question</th>
          <th>Answer (employee / editable)</th>
          <th>Manager rating (0-4)</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody>
        {% for ans in answers %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ ans.question.text }}</td>
          <td>
            <textarea name="answer_{{ ans.question.id }}" class="form-control" rows="3">{{ ans.answer_text }}</textarea>
          </td>
          <td>
            <select name="rating_{{ ans.question.id }}" class="form-select">
              <option value="">--</option>
              {% for r in "0,1,2,3,4"|split:"," %}
                <option value="{{ r }}" {% if ans.manager_rating|stringformat:"s" == r %}selected{% endif %}>{{ r }}</option>
              {% endfor %}
            </select>
          </td>
          <td>
            <textarea name="notes_{{ ans.question.id }}" class="form-control">{{ ans.manager_notes }}</textarea>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <button type="submit" class="btn btn-primary">Save Ratings & Answers</button>
    <a href="{% url 'skills:assign-skills' %}" class="btn btn-secondary">Back</a>
  </form>
</div>
{% endblock %}
