{% load widget_tweaks %}

<div class="card mb-4">
    <div class="card-body">
        <div class="row g-3">

            <!-- Project -->
            <div class="col-md-6">
                <label for="{{ form.project.id_for_label }}" class="form-label">Project</label>
                {{ form.project|add_class:"form-select" }}
                {{ form.project.errors }}
            </div>

            <!-- Expense Type -->
            <div class="col-md-6">
                <label for="id_new_expense_type" class="form-label">Expense Type</label>
                <select name="{{ form.new_expense_type.name }}"
                        id="id_new_expense_type"
                        class="form-select"
                        required>
                    <option value="">-- Select Expense Type --</option>
                    {% for type in form.new_expense_type.field.queryset %}
                        <option value="{{ type.id }}"
                            data-requires-km="{{ type.requires_kilometers|yesno:'true,false' }}"
                            data-requires-receipt="{{ type.requires_receipt|yesno:'true,false' }}"
                            data-rate="{{ type.rate_per_km|default:0 }}"
                            data-requires-travel="{{ type.requires_travel_locations|yesno:'true,false' }}"
                            data-max-cap="{{ type.max_amount_allowed|default:0 }}"
                            {% if form.new_expense_type.value|stringformat:'s' == type.id|stringformat:'s' %}selected{% endif %}>
                            {{ type.name }}
                        </option>
                    {% endfor %}
                </select>
                {{ form.new_expense_type.errors }}
            </div>

            <!-- Travel Fields -->
            <div class="col-md-6" id="travel-fields-from" style="display:none;">
                <label for="{{ form.from_location.id_for_label }}" class="form-label">From Location</label>
                {{ form.from_location|add_class:"form-control" }}
                {{ form.from_location.errors }}
            </div>

            <div class="col-md-6" id="travel-fields-to" style="display:none;">
                <label for="{{ form.to_location.id_for_label }}" class="form-label">To Location</label>
                {{ form.to_location|add_class:"form-control" }}
                {{ form.to_location.errors }}
            </div>

            <!-- Date -->
            <div class="col-md-4">
                <label for="{{ form.date.id_for_label }}" class="form-label">Date</label>
                {{ form.date|add_class:"form-control" }}
                {{ form.date.errors }}
            </div>

            <!-- Distance (KM) -->
            <div class="col-md-4" id="kilometersField" style="display: none;">
                <label for="id_kilometers" class="form-label">Kilometers</label>
                {{ form.kilometers|add_class:"form-control" }}
                {{ form.kilometers.errors }}
            </div>

            <!-- Amount -->
            <div class="col-md-4" id="amountField">
                <label for="id_amount" class="form-label" id="amountLabel">Amount (â‚¹)</label>
                {{ form.amount|add_class:"form-control" }}
                {{ form.amount.errors }}
            </div>

            <!-- Receipt Upload -->
            <div class="col-md-6">
                <label for="{{ form.receipt.id_for_label }}" class="form-label">Upload Receipt</label>
                {{ form.receipt|add_class:"form-control" }}
                {{ form.receipt.errors }}
                {% if editing and form.instance.receipt %}
                    <div class="mt-2">
                        <a href="{{ form.instance.receipt.url }}" target="_blank">View Existing Receipt</a>
                    </div>
                {% endif %}
            </div>

            <!-- Comments -->
            <div class="col-md-6">
                <label for="{{ form.comments.id_for_label }}" class="form-label">Comments</label>
                {{ form.comments|add_class:"form-control" }}
                <div style="max-height: 100px; overflow-y: auto;">
                    {{ form.comments.errors }}
                </div>
            </div>
        </div>
    </div>
</div>




