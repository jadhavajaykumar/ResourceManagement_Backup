{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h3>Attendance / C-Off Report</h3>

  <!-- Month/Year Filter -->
  <form method="get" class="form-inline mb-3">
    <label for="month">Month:</label>
    <select name="month" id="month" class="form-control mx-2">
      {% for val, name in available_months %}
        <option value="{{ val }}" {% if val == month %}selected{% endif %}>{{ name }}</option>
      {% endfor %}
    </select>

    <label for="year">Year:</label>
    <select name="year" id="year" class="form-control mx-2">
      {% for y in available_years %}
        <option value="{{ y }}" {% if y == year %}selected{% endif %}>{{ y }}</option>
      {% endfor %}
    </select>

    <button type="submit" class="btn btn-primary ml-2">Filter</button>
  </form>

  <!-- Summary Table -->
  <table class="table table-bordered">
    <thead>
      <tr>
        <th>Month</th>
        <th>Total Working Days</th>
        <th>Attended Days</th>
        <th>Attendance %</th>
        <th>C-Off Balance</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>{{ month }}/{{ year }}</td>
        <td>{{ working_days }}</td>
        <td>{{ attendance_days }}</td>
        <td>{{ attendance_percent }}%</td>
        <td>{{ c_off_balance }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Approved Attendance Days -->
  <!--<h5 class="mt-5">Approved Attendance Records</h5>
  <table class="table table-sm table-hover table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Hours</th>
        <th>Project</th>
        <th>Task</th>
      </tr>
    </thead>
    <tbody>
      {% for ts in records %}
        <tr>
          <td>{{ ts.date }}</td>
          <td>{{ ts.total_duration }}</td>
          <td>{{ ts.project.project_name }}</td>
          <td>{{ ts.task.name }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="4">No records found for this month.</td></tr>
      {% endfor %}
    </tbody>
  </table>-->

  <!-- C-Off Application Form -->
  <h4 class="mt-4">Apply for Compensatory Off</h4>
  <form method="post" class="mt-3 mb-4" style="max-width: 450px;">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>
  <h4>Past C-Off Applications</h4>
	<table class="table table-sm table-bordered mt-3">
	  <thead>
		<tr>
		  <th>Date Applied For</th>
		  <th>Days Requested</th>
		  <th>Reason</th>
		  <th>Status</th>
		  <th>Date Requested</th>
		</tr>
	  </thead>
	  <tbody>
		{% for app in past_applications %}
		  <tr>
			<td>{{ app.date_applied_for }}</td>
			<td>{{ app.number_of_days }}</td>
			<td>{{ app.reason }}</td>
			<td>{{ app.status }}</td>
			<td>{{ app.date_requested|date:"d M Y" }}</td>
		  </tr>
		{% empty %}
		  <tr><td colspan="5">No past applications found.</td></tr>
		{% endfor %}
	  </tbody>
	</table>

  
</div>
{% endblock %}
